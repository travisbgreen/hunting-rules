## https://redmine.openinfosecfoundation.org/projects/suricata/wiki/protocol_anomalies_detection
alert tcp any any -> any !80 (msg:"SURICATA HTTP on unusual port"; flow:to_server; app-layer-protocol:http; threshold:type limit, track by_src, seconds 60, count 1; sid:2600001; rev:1;)
alert tcp any any -> any 80 (msg:"SURICATA non-HTTP on TCP port 80"; flow:to_server; app-layer-protocol:!http; threshold:type limit, track by_src, seconds 60, count 1; sid:2600002; rev:1;)
alert tcp any any -> any ![443,465,587] (msg:"SURICATA TLS on unusual port"; flow:to_server; app-layer-protocol:tls; threshold:type limit, track by_src, seconds 60, count 1; sid:2600003; rev:1;)
alert tcp any any -> any [443,465] (msg:"SURICATA non-TLS on TLS port"; flow:to_server; app-layer-protocol:!tls; threshold:type limit, track by_src, seconds 60, count 1; sid:2600004; rev:1;)
alert tcp any any -> any ![20,21] (msg:"SURICATA FTP on unusual TCP port"; flow:to_server; app-layer-protocol:ftp; threshold:type limit, track by_src, seconds 60, count 1; sid:2600005; rev:1;)
alert tcp any any -> any [20,21] (msg:"SURICATA non-FTP on TCP port 21"; flow:to_server; app-layer-protocol:!ftp; threshold:type limit, track by_src, seconds 60, count 1; sid:2600006; rev:1;)
alert tcp any any -> any !22 (msg:"SURICATA SSH on unusual port"; flow:to_server; app-layer-protocol:ssh; threshold:type limit, track by_src, seconds 60, count 1; sid:2600007; rev:1;)
alert tcp any any -> any 22 (msg:"SURICATA non-SSH on TCP port 22"; flow:to_server; app-layer-protocol:!ssh; threshold:type limit, track by_src, seconds 60, count 1; sid:2600008; rev:1;)
alert tcp any any -> any !143 (msg:"SURICATA IMAP on unusual port"; flow:to_server; app-layer-protocol:imap; threshold:type limit, track by_src, seconds 60, count 1; sid:2600009; rev:1;)
alert tcp any any -> any 143 (msg:"SURICATA non-IMAP on TCP port 143"; flow:to_server; app-layer-protocol:!imap; threshold:type limit, track by_src, seconds 60, count 1; sid:2600010; rev:1;)
alert tcp any any -> any 139 (msg:"SURICATA non-SMB on TCP port 139"; flow:to_server; app-layer-protocol:!smb; threshold:type limit, track by_src, seconds 60, count 1; sid:2600011; rev:1;)
alert tcp any any -> any [80,8080] (msg:"SURICATA DCERPC detected over port tcp 80,8080"; flow:to_server; app-layer-protocol:dcerpc; threshold:type limit, track by_src, seconds 60, count 1; sid:2600012; rev:1;)
alert tcp any any -> any !53 (msg:"SURICATA DNS-TCP on unusual port"; flow:to_server; app-layer-protocol:dns; threshold:type limit, track by_src, seconds 60, count 1; sid:2600013; rev:1;)
alert tcp any any -> any 53 (msg:"SURICATA non-DNS-TCP on TCP port 53"; flow:to_server; app-layer-protocol:!dns; threshold:type limit, track by_src, seconds 60, count 1; sid:2600014; rev:1;)
alert udp any any -> any !53 (msg:"SURICATA DNS-UDP on unusual port"; flow:to_server; app-layer-protocol:dns; threshold:type limit, track by_src, seconds 60, count 1; sid:2600015; rev:1;)
alert udp any any -> any 53 (msg:"SURICATA non-DNS-UDP on UDP port 53"; flow:to_server; app-layer-protocol:!dns; threshold:type limit, track by_src, seconds 60, count 1; sid:2600016; rev:1;)

## hunting / hueristic rules
alert http any any -> any any (msg:"TGI HUNT unknown command 610cker"; flow:to_server,established; content:"POST"; http_method; content:"/command.php"; http_uri; content:"cmd="; http_client_body; depth:4; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600019; rev:1;)
alert http any any -> any any (msg:"TGI HUNT unknown etherium server probe"; flow:to_server,established; content:"POST"; http_method; urilen:1; content:"method|22 3a 22|eth_accounts"; http_client_body; http_content_type; content:"application/json"; reference:url,github.com/ethereum/wiki/wiki/JSON-RPC; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600020; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Graves Accent (backtick) in HTTP Header"; flow:established,to_server; content:"`"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600021; rev:2;)
alert http any any -> any any (msg:"TGI HUNT Content-Type jpeg serving PE likely hostile"; flow:established,from_server; content:"200"; http_stat_code; content:"Content-Type|3a 20|image/jpeg"; http_header; file_data; content:"MZ"; depth:2; byte_jump:4,58,relative,little; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600022; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal in Zip"; flow:established; content:"PK"; content:"|2e 2e 5c|"; distance:28; within:3; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600023; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal chars in HTTP Response"; flow:established,to_client; content:"|2e 2e 5c|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600024; rev:1;)
alert http any any -> any any (msg:"TGI HUNT unsafe PHP function in HTTP POST"; flow:established; content:"shell_exec("; http_client_body; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600025; rev:1;)
alert http any any -> any any (msg:"TGI HUNT unsafe PHP function in HTTP"; flow:established; content:"eval("; http_client_body; fast_pattern; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600026; rev:1;)
alert http any any -> any any (msg:"TGI HUNT two %25 in HTTP URI"; flow:to_server,established; content:"%25"; http_raw_uri; content:"%25"; http_raw_uri; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600029; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in HTTP POST"; flow:to_server,established; content:"%2525"; nocase; http_client_body; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600030; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Serialized PHP inbound"; flow:established,to_server; content:"O|3a|"; pcre:"/\bO\x3a\d+\x3a[^\r\n]*?\{/i"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600031; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI <>"; flow:to_server,established; content:"%253C"; nocase; http_raw_uri; content:"%253E"; nocase; http_raw_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600032; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI x28 x29"; flow:to_server,established; content:"%2528"; nocase; http_raw_uri; content:"%2529"; nocase; http_raw_uri;  threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600033; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI x3a"; flow:to_server,established; content:"%253A"; nocase; http_raw_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600034; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in URI x3b"; flow:to_server,established; content:"%253B"; nocase; http_raw_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600035; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicous HTTP URI and Referer are the same"; flow:established,to_server; content:"GET "; depth:4; pcre:"/^\/(.+) HTTP.*Referer[^\r\n]+\1\r\n/Rs"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600036; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Double Transfer-Encoding Header (possible evasion)"; flow:established,to_server; content:"Transfer-Encoding|3a 20|"; http_header; fast_pattern; content:"Transfer-Encoding|3a 20|"; http_header; distance:0; reference:url,noxxi.de/research/http-evader-explained-3-chunked.html; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600037; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP/1.0 and Transfer-Encoding Header (possible evasion)"; flow:established,to_server; content:"Transfer-Encoding|3a 20|"; http_header; fast_pattern; content:"HTTP/1.0"; depth:8; reference:url,noxxi.de/research/http-evader-explained-3-chunked.html; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600038; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP POST to wp-.* without referer"; flow:established,to_server; content:"POST"; http_method; content:"/wp-"; http_uri; http_header_names; content:!"Referer"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown;  sid:2600039; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT Oracle Server Probe"; flow:to_server,established; content:"(DESCRIPTION=(CONNECT_DATA=(SID=";  threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600041; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT BurpSuite string in TLS"; flow:established; content:"|0b|PortSwigger"; distance:1; within:12; reference:url,portswigger.net/burp/proxy.html; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600042; rev:1;)
alert tcp any any -> any [25,587] (msg:"TGI HUNT suspicious x-library Indy"; flow:established,to_server; content:"|0d 0a|X-Library|3a| Indy|20|"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600043; rev:6;)
alert tcp any any -> any [25,587] (msg:"TGI HUNT suspicious x-mailer MS CDO"; flow:established; content:"X-Mailer|3a 20|Microsoft CDO for Windows"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600044; rev:6;)
alert tcp any any -> any [25,587] (msg:"TGI HUNT suspicious x-mailer Blat"; flow:established; content:"X-Mailer|3a 20|Blat v"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600045; rev:6;)
alert tcp-pkt any any -> any any (msg:"TGI HUNT Too many \x41"; flow:established; content:"|41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600046; rev:1;)
alert tcp-pkt any any -> any any (msg:"TGI HUNT Too many \x90"; flow:established; content:"|90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90 90|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600047; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT WPAD Request"; dns_query; content:"wpad"; nocase; startswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600048; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT netsh firewall"; flow:established; content:"netsh firewall"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600049; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT netsh advfirewall"; flow:established; content:"netsh advfirewall"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600050; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT MS Copyright Banner"; flow:established; content:"Copyright |28|C|29|"; content:"Microsoft Corp"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600051; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT WMIC Prompt"; flow:established; content:"wmic|3a|root|5c|cli>"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600052; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT sc output"; flow:established; content:"SERVICE_NAME|3a|"; content:"TYPE"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600053; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT Unknown Login Attempt"; flow:established; content:"Action|3a 20|Login"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600054; rev:1;)
alert http any any -> any any (msg:"TGI HUNT non printable char in HTTP Request"; flow:established,to_server; pcre:"/^[\x20-\x7e\r\n]{0,20}[^\x20-\x7e\r\n]/"; http_content_type; content:!"application/ocsp-response"; threshold:type limit, track by_src, seconds 180, count 1; classtype:bad-unknown; sid:2600055; rev:1;)
alert http any any -> any any (msg:"TGI HUNT frocharcode in HTTP"; flow:established; content:"fromcharcode"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600056; rev:1;)
alert http any any -> any any (msg:"TGI HUNT PHP magic bytes in HTTP response"; flow:established,to_client; content:"<?php"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600057; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"DELETE"; content:"FROM"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600058; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"EXEC"; content:"FROM"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600059; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"INSERT"; content:"INTO"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600060; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"SELECT"; pcre:"/\b(?:INTO|FROM|USER|UPPER|LOWER|CONCAT)\b/R";  threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600061; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"SHOW"; pcre:"/\b(?:CHAR|CUR|TABLE|VAR)/R";  threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600062; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"UNION"; content:"SELECT"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600063; rev:1;)
alert http any any -> any any (msg:"TGI HUNT SQL verb in HTTP"; flow:established; content:"UPDATE"; content:"SET"; distance:0; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600064; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP uncommon version Request"; flow:established,to_server; content:"|20|HTTP/"; content:!"1.1"; within:3; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600065; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP suspicious UA"; flow:established; content:"bot"; nocase; http_user_agent; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600066; rev:1;)
alert http any any -> any any (msg:"TGI HUNT HTTP uncommon version Response"; flow:established,to_client; content:"HTTP/"; depth:5; content:!"1.1"; within:3; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600067; rev:1;)

## abused TLD stuff, see notes for generating
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .tk in DNS"; flow:established; dns_query; content:".tk"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600070; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .ml in DNS"; flow:established; dns_query; content:".ml"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600071; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .ga in DNS"; flow:established; dns_query; content:".ga"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600072; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .cf in DNS"; flow:established; dns_query; content:".cf"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600073; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .gq in DNS"; flow:established; dns_query; content:".gq"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600074; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .work in DNS"; flow:established; dns_query; content:".work"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600075; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .date in DNS"; flow:established; dns_query; content:".date"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600076; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .top in DNS"; flow:established; dns_query; content:".top"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600077; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .review in DNS"; flow:established; dns_query; content:".review"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600078; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .stream in DNS"; flow:established; dns_query; content:".stream"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600079; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .trade in DNS"; flow:established; dns_query; content:".trade"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600080; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .loan in DNS"; flow:established; dns_query; content:".loan"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600081; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .science in DNS"; flow:established; dns_query; content:".science"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600082; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .gdn in DNS"; flow:established; dns_query; content:".gdn"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600083; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .click in DNS"; flow:established; dns_query; content:".click"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600084; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .date in DNS"; flow:established; dns_query; content:".date"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600085; rev:1;)
alert dns any any -> any any (msg:"TGI HUNT Abused TLD .racing in DNS"; flow:established; dns_query; content:".racing"; endswith; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600086; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .tk in SNI"; flow:established,to_server; tls_sni; content:".tk"; endswith; classtype:bad-unknown; sid:2600087;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .ml in SNI"; flow:established,to_server; tls_sni; content:".ml"; endswith; classtype:bad-unknown; sid:2600088;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .ga in SNI"; flow:established,to_server; tls_sni; content:".ga"; endswith; classtype:bad-unknown; sid:2600089;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .cf in SNI"; flow:established,to_server; tls_sni; content:".cf"; endswith; classtype:bad-unknown; sid:2600090;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .gq in SNI"; flow:established,to_server; tls_sni; content:".gq"; endswith; classtype:bad-unknown; sid:2600091;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .work in SNI"; flow:established,to_server; tls_sni; content:".work"; endswith; classtype:bad-unknown; sid:2600092;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .date in SNI"; flow:established,to_server; tls_sni; content:".date"; endswith; classtype:bad-unknown; sid:2600093;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .top in SNI"; flow:established,to_server; tls_sni; content:".top"; endswith; classtype:bad-unknown; sid:2600094;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .review in SNI"; flow:established,to_server; tls_sni; content:".review"; endswith; classtype:bad-unknown; sid:2600095;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .stream in SNI"; flow:established,to_server; tls_sni; content:".stream"; endswith; classtype:bad-unknown; sid:2600096;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .trade in SNI"; flow:established,to_server; tls_sni; content:".trade"; endswith; classtype:bad-unknown; sid:2600097;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .loan in SNI"; flow:established,to_server; tls_sni; content:".loan"; endswith; classtype:bad-unknown; sid:2600098;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .science in SNI"; flow:established,to_server; tls_sni; content:".science"; endswith; classtype:bad-unknown; sid:2600099;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .gdn in SNI"; flow:established,to_server; tls_sni; content:".gdn"; endswith; classtype:bad-unknown; sid:2600100;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .click in SNI"; flow:established,to_server; tls_sni; content:".click"; endswith; classtype:bad-unknown; sid:2600101;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .date in SNI"; flow:established,to_server; tls_sni; content:".date"; endswith; classtype:bad-unknown; sid:2600102;)
alert tls any any -> any any (msg:"TGI HUNT Abused TLD .racing in SNI"; flow:established,to_server; tls_sni; content:".racing"; endswith; classtype:bad-unknown; sid:2600103;)
alert http any any -> any any (msg:"TGI HUNT WScript.Shell Inbound"; flow:established,to_client; file_data; content:"WScript.Shell"; nocase; classtype:bad-unknown; sid:2600108; rev:1;)
alert http any any -> any any (msg:"TGI HUNT .bin HTTP download missing headers"; flow:established,to_server; content:".bin"; http_uri; endswith; http_header_names; content:"|0d 0a|Host|0d 0a|Connection|0d 0a 0d 0a|"; classtype:bad-unknown; sid:2600109; rev:1;)
alert tcp any any -> any any (msg:"TGI HUNT wmic process call create"; flow:established; content:"wmic process call create"; classtype:bad-unknown; sid:2600110; rev:1;)
alert tcp any any -> any any (msg:"IBM WebSphere Application Server probe"; flow:established; content:"SOAPAction: urn:AdminService|0d 0a|"; http_header; reference:url,https://github.com/breenmachine/JavaUnserializeExploits/blob/master/websphere-soap-exploit.request; classtype:bad-unknown; sid:2600111; rev:1;)
alert ftp any any -> any any (msg:"TGI HUNT FTP STOR Command"; flow:established; content:"STOR|20|"; classtype:bad-unknown; sid:2600112; rev:1;)
alert http any any -> any any (msg:"TGI HUNT PHP Magic Bytes in HTTP Request"; flow:established,to_server; content:"<?php"; nocase; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600113; rev:1;)
alert http any any -> any any (msg:"TGI HUNT POST Without Referer Header"; flow:established,to_server; content:"POST"; http_method; http_header_names; content:!"Referer"; threshold:type limit, track by_src, seconds 180, count 1; http_content_type; content:!"application/ocsp-response"; classtype:bad-unknown; sid:2600114; rev:1;)
alert ip any any -> any any (msg:"TGI HUNT sameip Keyword Test Rule"; flow:established,to_server; sameip; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600116; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT TLS Suspicious facebook.com"; tls_cert_subject; content:"facebook.com"; tls_cert_fingerprint; content:!"98:e4:dd:9d:21:83:d5:29:9e:80:43:73:ff:f2:a7:e1:c4:87:9f:5e"; classtype:bad-unknown; sid:2600117; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Content-Type jpeg Serving Zip"; flow:established,from_server; content:"200"; http_stat_code; content:"Content-Type|3a 20|image/jpeg"; http_header; file_data; content:"PK"; depth:2; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600118; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious vbs Function Inbound"; flow:established,from_server; content:"200"; http_stat_code; file_data; content:"new-object -com|20|"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600119; rev:1;)
alert udp $HOME_NET any -> any 53 (msg:"TGI HUNT Large DNS Query not TCP"; content:"|01 00 00 01 00 00 00 00 00 00|"; fast_pattern; depth:10; offset:2; dsize:>512; classtype:bad-unknown; sid:2600120; rev:8;)
alert http any any -> any any (msg:"TGI HUNT Double Encoded Characters in HTTP URI"; flow:to_server,established; content:"%2525"; http_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600121; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious HTTP Path"; flow:to_server,established; content:"/Panel/"; http_uri; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600122; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious HTTP Server Response (localhost)"; flow:to_client,established; content:"Server|3a 20|localhost|0d 0a|"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600123; rev:1;)
#alert ip any any -> any any (msg:"TGI HUNT non-DiffServ aware TOS setting"; flow:established,to_server; tos:!0; tos:!8; tos:!16; tos:!24; tos:!32; tos:!40; tos:!48; tos:!56; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600124; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response"; flow:to_client,established; file_data; content:"There's been an awakening... have you felt it?"; threshold:type limit,track by_src,seconds 60,count 1; classtype:bad-unknown; sid:2600125; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x86 1"; flow:to_client,established; file_data; content:"|89 71 04 89|"; content:"|30 8d 04 bd|"; within:8; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2600126; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x86 2"; flow:to_client,established; file_data; content:"|8b 4d|"; content:"|8b 45 f4 89 75|"; within:6; content:"|89 01 85 ff 74|"; within:6; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2600127; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x64 1"; flow:to_client,established; file_data; content:"|33 ff|"; content:"|89 37|"; within:3; content:"|8b f3 45 85|"; within:5; content:"|74|"; within:2; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2600128; rev:1;)
alert http any any -> any any (msg:"TGI HUNT MimiKatz String in HTTP Response x64 2"; flow:to_client,established; file_data; content:"|4c 8b df 49|"; content:"|c1 e3 04 48|"; within:8; content:"|8b cb 4c 03|"; within:8; content:"|d8|"; within:2; threshold:type limit,track by_src,seconds 60,count 1; reference:url,github.com/gentilkiwi/mimikatz/releases; classtype:bad-unknown; sid:2600129; rev:1;)
alert http any any -> any any (msg:"TGI HUNT LaZagne Artifact in HTTP POST"; flow:to_server,established; content:"LaZagne Project"; http_client_body; classtype:bad-unknown; sid:2600130; rev:1;)
alert http any any -> any any (msg:"TGI HUNT LaZagne Artifact in HTTP POST 2"; flow:to_server,established; content:"|20|passwords -----------------"; http_client_body; classtype:bad-unknown; sid:2600131; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT DNS over TLS JA3 SSL-Client Fingerprint Detected (Stubby)"; ja3_hash; content:"c369db2c355ad05c76f5660af3179b01"; reference:url,www.linuxbabe.com/ubuntu/ubuntu-stubby-dns-over-tls; sid:2600132; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (Emotet/AutoIt/Ursnif)"; ja3_hash; content:"4d7a28d6f2263ed61de88ca66eb011e3"; reference:url,engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967; sid:2600133; rev:1;)
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (Trickbot)"; ja3_hash; content:"6734f37431670b3ab4292b8f60f29984"; reference:url,engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967; sid:2600134; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (Trickbot)"; ja3_hash; content:"e7d705a3286e19ea42f587b344ee6865"; reference:url,engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967; sid:2600135; rev:1;)
alert http any any -> any any (msg:"TGI HUNT mimikatz Artifacts in HTTP POST"; flow:to_server,established; content:"S-1-5-21-"; nocase; http_client_body; content:"Username"; nocase; http_client_body; content:"Domain"; nocase; http_client_body; content:"NTLM"; nocase; http_client_body; content:"SHA1"; nocase; http_client_body; classtype:bad-unknown; sid:2600136; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Invoke-ReflectivePEInjection Likely Malicious PS Inbound"; flow:from_server,established; content:"Write-BytesToMemory"; content:"Invoke-CreateRemoteThread"; content:"VirtualAllocEx"; content:"WriteProcessMemory"; classtype:bad-unknown; sid:2600137; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Non Browser HTTP to Pastebin"; flow:to_server,established; content:"pastebin.com"; http_host; content:!"Mozilla"; nocase; http_user_agent; classtype:bad-unknown; sid:2600138; rev:1;)
# too common to be useful
#alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (IcedID/Orcus/.net WebClient().DownloadString()/js.griffon/WinHttpConnect)"; ja3_hash; content:"1d095e68489d3c535297cd8dffb06cb9"; reference:md5,de3ea56487dd2ebfcc5cb4d430aa51a9; sid:2600139; rev:1;)
alert tls any any -> any any (msg:"TGI HUNT JA3 SSL-Client Fingerprint Detected (GoldenAxe Ransomware)"; ja3_hash; content:"5001b4c2a48c94b76ca1f0199345fe60"; reference:md5,87c1b3e2b788dd54d196fb67ba0da6dc; sid:2600140; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal chars in HTTP Request Header"; flow:established,to_server; content:"|2e 2e 5c|"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600141; rev:1;)
alert http any any -> any any (msg:"TGI HUNT directory traversal chars in HTTP Request Header"; flow:established,to_server; content:"|2e 2e 2f|"; http_header; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600142; rev:1;)
alert ftp-data $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Password Artifact Outbound in FTP"; flow:established,to_server; content:"Password"; fast_pattern; pcre:"/\bPassword\b/"; reference:url,github.com/AlessandroZ/LaZagne; classtype:trojan-activity; sid:2600143; rev:1;)
alert ftp $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Cookie STOR Outbound in FTP"; flow:established,to_server; content:"STOR|20|"; depth:5; content:"cookies"; nocase; distance:0; fast_pattern; pcre:"/\bcookies\b/i"; classtype:trojan-activity; sid:2600144; rev:1;)
alert ftp $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT log STOR Outbound in FTP"; flow:established,to_server; content:"STOR|20|"; depth:5; content:"log"; nocase; distance:0; fast_pattern; pcre:"/\blog\b/i"; classtype:trojan-activity; sid:2600145; rev:1;)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT CobaltStrike Artifact in DNS"; flow:established,to_server; dns_query; content:".stage.123456."; reference:url,threatexpress.com/blogs/2018/a-deep-dive-into-cobalt-strike-malleable-c2/; classtype:trojan-activity; sid:2600146; rev:1;)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT CobaltStrike Artifact in DNS"; flow:established,to_server; dns_query; content:".resources.123456."; reference:url,threatexpress.com/blogs/2018/a-deep-dive-into-cobalt-strike-malleable-c2/; classtype:trojan-activity; sid:2600147; rev:1;)
alert dns $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT CobaltStrike Artifact in DNS"; flow:established,to_server; dns_query; content:".feeds.123456."; reference:url,threatexpress.com/blogs/2018/a-deep-dive-into-cobalt-strike-malleable-c2/; classtype:trojan-activity; sid:2600148; rev:1;)
alert udp $HOME_NET any -> $EXTERNAL_NET any (msg:"TGI HUNT Anomalous DNS >512 bytes over UDP"; dsize:>512; prefilter; content:"|01 00 00 01 00 00 00 00 00 00|"; offset:2; depth:10; reference:url,tools.ietf.org/html/rfc5966; classtype:trojan-activity; sid:2600149; rev:1;)
alert ftp any any -> any any (msg:"TGI HUNT abnormally long STOR in FTP"; flow:established,to_server; content:"STOR"; depth:4; isdataat:256,relative; classtype:bad-unknown; sid:2600150; rev:1;)
alert ftp any any -> any any (msg:"TGI HUNT abnormally long SIZE in FTP"; flow:established,to_server; content:"SIZE"; depth:4; isdataat:256,relative; classtype:bad-unknown; sid:2600151; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Frequently Abused Java Invocation in HTTP POST Body"; flow:established,to_server; content:"java.lang.ProcessBuilder"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; reference:url,blog.talosintelligence.com/2019/04/sodinokibi-ransomware-exploits-weblogic.html; sid:2600152; rev:1;)
alert http any any -> any any (msg:"TGI HUNT Suspicious Filename Powershell Download"; flow:established,to_server; content:"GET"; http_method; content:".ps1"; http_uri; endswith; fast_pattern; pcre:"/(?:keylogger|rat|stealer|remote)[^/]*\.ps1$/Ui"; http_header_names; content:!"Referer"; threshold:type limit, track by_src, seconds 60, count 1; classtype:bad-unknown; sid:2600153; rev:1;)

# TODO update risky tlds; expand to dns, http host


